# 深入理解计算机系统

```c
#include <stdio.h>

int main()
{
	printf("hello, world\n");
	return 0;
}
```

## 跟踪上面C代码的生命周期:

> 1. 源文件:`hello.c`,由01组成的位序列存储
> 
> 	> - 1字节(byte) = 8位(比特/bit)
> 	> - 每个字节代表我们在编辑器里打的某个文本字符
> 	
> 2. 一般使用**ASCII码**来表示文本字符
> 	*--使用唯一的单字节大小(8位的0/1)的整数值表示每个字符*
> 	所以,能表示的字符数为2^8=256个字符
> 	典型的例子:
> 	\n换行符 => 10
> 3. 只有ASCII字符构成的文件称为**文本文件**,其他的都称为**二进制文件**
> 
> 4. 所以可以知道,所有文件都是以二进制序列表示的
> 5. Unix几乎是由C语言写成的,系统级编程的首选

1. `linux> gcc -o hello hello.c`

	> 1. 每条语句,人是看懂了,但是机器看不懂,所以每条语句要被其他程序转换为一系列的**低级机器语言指令**
	> 2. 然后这些指令打包成**可执行目标程序**,以二进制磁盘文件的形式存放起来
	> 3. GCC是编译器驱动程序,把`hello.c` => `hello`,存放在磁盘上

	这个过程包括: 
		预处理(cpp): 识别\#开头的语句,修改原始的C程序,=>.i
		编译(ccl): 翻译=> .s, 包含一个汇编语言程序,包含main的定义
		汇编(as): 翻译成机器语言指令=> .o
		链接(ld): 链接库中的.o,共同合并为可执行文件


2. 执行 `> ./hello`


## 硬件

1. 总线: 传输数据,以'字'为单位,字长对应32位(4bytes)/64位(8bytes)系统参数
I/O: 鼠标/键盘/显示器/磁盘,系统与外界的联系通道

2. IO设备,通过:
		1. 控制器(主板上的芯片组)
		2. 适配器(主板插槽上的卡)
	与IO总线链接
3. 主存:临时存储设备,由一组DRAM(动态随机存取存储器)组成,存储器是一个字节数组,每条机器指令是有不同数量的字节构成
4. 处理器:核心是寄存器(大小为一个字)的计数器(PC),任何时候,PC指向某条指令的地址


# 大致的运行过程

`$ shell 文件路径 `在shell命令的最后,会把一个文件编译成汇编语言,里边是一行行指令,描述这条代码执行时的要走的流程步骤; 同时PC(progress computer)程序计数器会存入第一条指令的第一个字节的地址,以便文件开始执行

开始执行这个文件所描述的指令
寄存器根据pc里的地址定位到当前要执行的指令,通过内存主线和cpu主线拿到内存里的相应指令,开始执行

这个过程中, ALU(算数逻辑单元,运算器)会根据指令把指定寄存器里的数据做运算,结果存下来



# 网上详解
### cpu主要有3部分构成

1. 寄存器
2. 控制器(cu)
	1. 指令寄存器(IR, instructionRegister)
	2. 程序计数器(PC, programCounter)
	3. 操作控制器(OC, OperationController)
3. ALU(算数逻辑运算单元,运算器)


### 图示
![](http://www.myexception.cn/img/2014/04/17/094735466.jpg)

### 过程
**五步: 取,译,执行,访存取数, 结果写回**

1. 取指令: 
	PC中的数值,指示了当前指令在内存中的位置,当一条指令被取出后,PC会根据指令字长而自动累加
2. 指令译码(ID, instruction Decode)
	指令译码器按照预定格式, 加工指令,
	识别出**不同的类别**和**各种获取操作数的方法**
3. 执行指令
	CPU的不同部分被连接起来,执行所需的操作
	例如: 要完成一个加法运算, ALU将被连接到一组输入和一组输出,输入数据然后输出结果
	
4. 访存取数
	根据指令需要,可能要访问内存,读取操作数.根据指令的地址码,得到操作数的地址,并从内存读取该操作数
5. 结果写回
	把执行指令的结果数据'写回'到某种存储形式---一般是寄存器中,以便被后边的指令快速的存取
	
6...取指令...循环

![](http://www.myexception.cn/img/2014/04/17/094735468.jpg)
